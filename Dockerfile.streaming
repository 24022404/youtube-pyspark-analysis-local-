FROM bitnami/spark:3.5.0

USER root

WORKDIR /opt/spark-apps

# Install Python dependencies
COPY requirements-streaming.txt .
RUN pip install --no-cache-dir -r requirements-streaming.txt

# Copy source code
COPY config.py .
COPY preprocessing.py .
COPY analysis.py .
COPY spark_streaming.py .

# Create checkpoint directory
RUN mkdir -p /tmp/spark-checkpoints && chmod 777 /tmp/spark-checkpoints

USER 1001

# Entry point will be set by docker-compose
